
#chip mega328p
'#config osc=INTosc, MCLRE=off, WDTE=Off, boren=off
wait 1 ms
    #include <UNO_mega328p.h >
'#include <glcd.h>
'#include<glcd_ili9326.h>
   #define GLCD_TYPE GLCD_TYPE_ILI9326
    #define GLCD_RST      portc.4         ' Reset line
    #define GLCD_RD       portc.3        ' read command line
    #define GLCD_WR       portc.2         ' write command line
    #define GLCD_RS       portc.1         ' Command/Data line
    #define GLCD_CS       portc.0         ' Chip select line


    #define GLCD_DB0       DIGITAL_8
    #define GLCD_DB1       DIGITAL_9
    #define GLCD_DB2       DIGITAL_2
    #define GLCD_DB3       DIGITAL_3
    #define GLCD_DB4       DIGITAL_4
    #define GLCD_DB5       DIGITAL_5
    #define GLCD_DB6       DIGITAL_6
    #define GLCD_DB7       DIGITAL_7




   ' #define GLCD_DB0       portd.0
    '#define GLCD_DB1       portd.1
   ' #define GLCD_DB2       portd.2
    '#define GLCD_DB3       portd.3
    '#define GLCD_DB4       portd.4
    '#define GLCD_DB5       portd.5
    '#define GLCD_DB6       portd.6
    '#define GLCD_DB7       portd.7
    dir portc out
    dir portb out

    #define GLCD_DataPort portD
    #define ILI9326_DataPort GLCD_DataPort

      #define ILI9326_GLCD_RST GLCD_RST
      #define ILI9326_GLCD_CS GLCD_CS
      #define ILI9326_GLCD_RS GLCD_RS
      #define ILI9326_GLCD_WR GLCD_WR
      #define ILI9326_GLCD_RD GLCD_RD

dir ILI9326_dataPort out

dim ILI9326SendWord, GLCD_width,GLCD_height,ILI9326_angle as word
dim xx1 as word
GLCD_WIDTH = 400
GLCD_HEIGHT = 240
ili9326_angle=0


do
ili9326init
ILI9326Orientation(ILI9326_angle)
GLCDCLS_ILI9326

glcdStripes_ILI9326
loop
sleep
end
sub SendCommand_ili9326(ILI9326SendWord)
          set ILI9326_GLCD_CS off
          set ILI9326_GLCD_RS OFF
          set ILI9326_GLCD_RD ON
          set ILI9326_GLCD_WR ON
    PORTD = (PORTD & 0B00000011) | ((ILI9326SendWord_H) & 0B11111100);
    PORTB = (PORTB & 0B11111100) | ((ILI9326SendWord_H) & 0B00000011);

          set ILI9326_GLCD_WR OFF
          set ILI9326_GLCD_WR ON
    PORTD = (PORTD & 0B00000011) | ((ILI9326SendWord) & 0B11111100);
    PORTB = (PORTB & 0B11111100) | ((ILI9326SendWord) & 0B00000011);
          set ILI9326_GLCD_WR OFF
          set ILI9326_GLCD_WR ON
end sub

sub SendData_ILI9326(ILI9326SendWord)
          set ILI9326_GLCD_RS ON
'ILI9326_DataPort=ILI9326SendWord_h
    PORTD = (PORTD & 0B00000011) | ((ILI9326SendWord_H) & 0B11111100);
    PORTB = (PORTB & 0B11111100) | ((ILI9326SendWord_H) & 0B00000011);

          set ILI9326_GLCD_WR OFF
          set ILI9326_GLCD_WR ON
'ILI9326_DataPort=ILI9326SendWord
    PORTD = (PORTD & 0B00000011) | ((ILI9326SendWord) & 0B11111100);
    PORTB = (PORTB & 0B11111100) | ((ILI9326SendWord) & 0B00000011);

          set ILI9326_GLCD_WR OFF
          set ILI9326_GLCD_WR ON





end sub

sub GLCDCLS_ILI9326
SendCommand_ili9326(0x0202)
repeat GLCD_width
repeat GLCD_height
sendData_ILI9326(0x0000)
end repeat
end repeat
end sub

sub GLCDStripes_ILI9326
'test for horizontal/vertical alignment
xx1=0x0000
SendCommand_ili9326(0x0202)
repeat GLCD_width
repeat GLCD_height
sendData_ILI9326(xx1)
end repeat
xx1=xx1+123
end repeat
end sub






sub ILI9326INIT




'Reset*********************
Set ILI9326_GLCD_RST On
Wait 15 ms
Set ILI9326_GLCD_RST Off
Wait 15 ms
Set ILI9326_GLCD_RST On
Wait 15 ms
'//*************Power On sequence ****************//
'parameters below taken from...
'*  Module for Microchip Graphics Library
'*  LCD controller driver*  ILI9326
'discharge*********************
SendCommand_ILI9326(0x0100)
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x0102)
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x0103)
SendData_ili9326(0x0000)
wait 200 ms 'power settings*****
SendCommand_ILI9326(0x0100)
SendData_ili9326(0x1190)
SendCommand_ILI9326(0x0101)
SendData_ili9326(0x0017)
SendCommand_ILI9326(0x0102)
SendData_ili9326(0x01BD)
SendCommand_ILI9326(0x0103)
SendData_ili9326(0x0350)
SendCommand_ILI9326(0x0281)
SendData_ili9326(0x0017)
SendCommand_ILI9326(0x0200)
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x0201)
SendData_ili9326(0x0000)
'set gamma curve**************
SendCommand_ILI9326(0x0300)
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x0301)
SendData_ili9326(0x0707)
SendCommand_ILI9326(0x0302)
SendData_ili9326(0x0606)
SendCommand_ILI9326(0x0305)
SendData_ili9326(0x0006)
SendCommand_ILI9326(0x0306)
SendData_ili9326(0x0A09)
SendCommand_ILI9326(0x0307)
SendData_ili9326(0x0203)
SendCommand_ILI9326(0x0308)
SendData_ili9326(0x0005)
SendCommand_ILI9326(0x0309)
SendData_ili9326(0x0007)
SendCommand_ILI9326(0x030C)
SendData_ili9326(0x0400)
SendCommand_ILI9326(0x030D)
SendData_ili9326(0x000A)
'set GRAM area**************
SendCommand_ILI9326(0x0210)
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x0211)
SendData_ili9326(0x00EF)' 240
SendCommand_ILI9326(0x212)
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x0213)
SendData_ili9326(0x018F) '400
SendCommand_ILI9326(0x0400)
SendData_ili9326(0x3500)
SendCommand_ILI9326(0x0401)
SendData_ili9326(0x0001)
SendCommand_ILI9326(0x0404)
SendData_ili9326(0x0000)

SendCommand_ILI9326(0x0010) 'set screen defaults
SendData_ili9326(0x0010)
SendCommand_ILI9326(0x0011) 'last set of commands
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x020B)
SendData_ili9326(0x0000)
SendCommand_ILI9326(0x0007)
SendData_ili9326(0x0173) 'display on

end sub

sub ILI9326Orientation(ILI9326_angle)
if ILI9326_angle=0 then
SendCommand_ILI9326(0x0003)
SendData_ili9326(0x0030)
end if
if ILI9326_angle=90 then
SendCommand_ILI9326(0x0003)
SendData_ili9326(0x0028)
end if
if ILI9326_angle=180 then
SendCommand_ILI9326(0x0003)
SendData_ili9326(0x0000)
end if
if ILI9326_angle=270 then
SendCommand_ILI9326(0x0003)
SendData_ili9326(0x0018)
end if
end sub
